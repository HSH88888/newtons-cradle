<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newton's Cradle Simulation</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            overflow: hidden;
            background-color: #0f0f0f;
            /* Even darker for premium feel */
            color: #ececec;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            height: 100dvh;
            /* iOS Safari fix */
            touch-action: none;
        }

        canvas {
            display: block;
            width: 100% !important;
            height: 100% !important;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        .header {
            position: absolute;
            top: 10%;
            text-align: center;
            pointer-events: none;
            z-index: 10;
        }

        h1 {
            font-weight: 200;
            letter-spacing: 5px;
            text-transform: uppercase;
            font-size: 2rem;
            margin-bottom: 5px;
            color: #fff;
        }

        .instructions {
            font-size: 0.8em;
            opacity: 0.5;
            letter-spacing: 1px;
        }

        .settings-panel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.8);
            padding: 20px 30px;
            border-radius: 16px;
            pointer-events: auto;
            display: flex;
            flex-direction: row;
            gap: 40px;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 100;
            width: auto;
            min-width: 600px;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 180px;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .label-text {
            font-size: 0.75rem;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .value-text {
            font-size: 0.9rem;
            font-family: monospace;
            color: #007aff;
            /* Accent color */
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: #333;
            border-radius: 2px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #007aff;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        /* Touch-friendly slider for mobile */
        @media (max-width: 768px) {
            input[type="range"]::-webkit-slider-thumb {
                width: 24px;
                height: 24px;
            }
        }

        /* Mobile Layout */
        @media (max-width: 768px) {
            .header {
                top: 5%;
                width: 100%;
                padding: 0 20px;
            }

            h1 {
                font-size: 1.5rem;
                /* Slightly larger for readability */
                margin-bottom: 2px;
            }

            .instructions {
                font-size: 0.7em;
            }

            .settings-panel {
                bottom: 20px;
                width: 95%;
                min-width: unset;
                padding: 15px;

                /* Grid Layout for Compactness */
                display: grid;
                grid-template-columns: 1fr 1fr;
                /* 2 Columns */
                gap: 12px;
            }

            .control-group {
                width: auto;
                flex: unset;
            }

            /* Reset button spans full width or fits nicely */
            #reset-btn {
                grid-column: span 2;
                height: 44px;
                /* Minimum touch target */
                margin-top: 5px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
</head>

<body>

    <div class="header">
        <h1>Newton's Cradle</h1>
        <p class="instructions">DRAG A BALL TO BEGIN</p>
    </div>

    <div class="settings-panel">
        <div class="control-group">
            <div class="label-row">
                <span class="label-text">Gravity</span>
                <span id="gravity-val" class="value-text">1.0</span>
            </div>
            <input type="range" id="gravity" min="0" max="3" step="0.1" value="1">
        </div>
        <div class="control-group">
            <div class="label-row">
                <span class="label-text">Length</span>
                <span id="length-val" class="value-text">200</span>
            </div>
            <input type="range" id="length" min="50" max="300" step="10" value="200">
        </div>
        <div class="control-group">
            <div class="label-row">
                <span class="label-text">Balls</span>
                <span id="count-val" class="value-text">5</span>
            </div>
            <input type="range" id="count" min="3" max="8" step="1" value="5">
        </div>
        <button id="reset-btn" style="
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            /* height: 50px; Removed fixed height for flexibility */
            align-self: flex-end; /* Align with inputs */
            margin-bottom: 5px;
            transition: all 0.2s ease;
            width: 100%; /* Full width in grid cell */
        " onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'"
            onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
            Reset
        </button>
    </div>

    <script>
        const Engine = Matter.Engine,
            Render = Matter.Render,
            Runner = Matter.Runner,
            Body = Matter.Body,
            Composites = Matter.Composites,
            MouseConstraint = Matter.MouseConstraint,
            Mouse = Matter.Mouse,
            World = Matter.World,
            Events = Matter.Events,
            Query = Matter.Query,
            Composite = Matter.Composite;

        const engine = Engine.create();
        const world = engine.world;

        const render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: window.innerWidth,
                height: window.innerHeight,
                wireframes: false,
                background: 'transparent'
                // pixelRatio: window.devicePixelRatio // Removed to fix touch coordinate mismatch on mobile
            }
        });

        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);

        let cradle;

        function createCradle() {
            if (cradle) Composite.remove(world, cradle);

            const number = parseInt(document.getElementById('count').value);
            const length = parseInt(document.getElementById('length').value);

            const w = window.innerWidth;
            const h = window.innerHeight;
            const isMobile = w < 768;

            // Dynamic Sizing Logic
            // Scale ball size based on width
            const maxAvailableWidth = w * (isMobile ? 0.8 : 0.9);
            const calculatedSize = (maxAvailableWidth / (number * 2.5));
            const size = Math.min(isMobile ? 25 : 30, calculatedSize); // Smaller balls on mobile

            // Centering logic
            const spacing = size * 2;
            const startX = (w / 2) - ((number - 1) * spacing) / 2;

            // Positioning: Move up on mobile to reduce gap from title and avoid UI overlap
            const startY = h * (isMobile ? 0.2 : 0.3);

            cradle = Composites.newtonsCradle(startX, startY, number, size, length);


            cradle.bodies.forEach(body => {
                // Polished metallic look
                body.render.fillStyle = '#f0f0f0';
                body.render.strokeStyle = '#333';
                body.render.lineWidth = 1;

                // Realistic Physics for Steel Balls
                body.density = 0.04; // Heavier (Steel)
                body.restitution = 1; // Elastic collision
                body.friction = 0;
                body.frictionAir = 0.0001; // Low air resistance
                body.slop = 0.05; // Prevent overlapping
            });

            cradle.constraints.forEach(constraint => {
                constraint.render.strokeStyle = 'rgba(255,255,255,0.15)';
                constraint.render.lineWidth = 1;
                constraint.stiffness = 1; // Rigid strings
            });

            World.add(world, cradle);
        }

        createCradle();

        const mouse = Mouse.create(render.canvas);
        const mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse,
            constraint: {
                // Stiff constraint effectively "locks" the ball to the mouse cursor
                stiffness: 1,
                angularStiffness: 1,
                render: { visible: false }
            }
        });

        World.add(world, mouseConstraint);
        render.mouse = mouse;

        Events.on(mouseConstraint, 'mousemove', (event) => {
            if (cradle) {
                const found = Query.point(cradle.bodies, event.mouse.position);
                document.body.style.cursor = found.length > 0 ? 'grab' : 'default';
            }
        });

        Events.on(mouseConstraint, 'startdrag', () => {
            document.body.style.cursor = 'grabbing';
        });

        Events.on(mouseConstraint, 'enddrag', () => {
            document.body.style.cursor = 'grab';
        });

        document.getElementById('gravity').addEventListener('input', function () {
            const val = parseFloat(this.value);
            engine.gravity.y = val;
            document.getElementById('gravity-val').textContent = val.toFixed(1);
        });

        document.getElementById('length').addEventListener('input', function () {
            document.getElementById('length-val').textContent = this.value;
            createCradle();
        });

        document.getElementById('count').addEventListener('input', function () {
            document.getElementById('count-val').textContent = this.value;
            createCradle();
        });

        // Reset functionality
        document.getElementById('reset-btn').addEventListener('click', function () {
            document.getElementById('gravity').value = 1.0;
            document.getElementById('gravity-val').textContent = '1.0';
            engine.gravity.y = 1.0;

            document.getElementById('length').value = 200;
            document.getElementById('length-val').textContent = '200';

            document.getElementById('count').value = 5;
            document.getElementById('count-val').textContent = '5';

            createCradle();
        });

        window.addEventListener('resize', () => {
            const w = window.innerWidth;
            const h = window.innerHeight;
            render.canvas.width = w;
            render.canvas.height = h;
            render.options.width = w;
            render.options.height = h;
            createCradle();
        });
    </script>
</body>

</html>